services:
  redis:
    container_name: redis
    image: redis
    ports:
      - "6379:6379"
  api:
    container_name: hudddle_api
    build: .
    ports:
      - "8000:80"
    working_dir: /app
    command: uvicorn main:app --host 0.0.0.0 --port 80 --app-dir app_src
    environment:
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET_KEY: ${JWT_SECRET_KEY}
      JWT_ALGORITHM: ${JWT_ALGORITHM}
      MAIL_USERNAME: ${MAIL_USERNAME}
      MAIL_PASSWORD: ${MAIL_PASSWORD}
      MAIL_FROM: ${MAIL_FROM}
      MAIL_PORT: ${MAIL_PORT}
      MAIL_SERVER: ${MAIL_SERVER}
      MAIL_FROM_NAME: ${MAIL_FROM_NAME}
      MAIL_STARTTLS: True
      MAIL_SSL_TLS: False
      USE_CREDENTIALS: True
      VALIDATE_CERTS: True
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GOOGLE_REDIRECT_URI: ${GOOGLE_REDIRECT_URI}
      GOOGLE_AUTH_ENDPOINT: ${GOOGLE_AUTH_ENDPOINT}
      GOOGLE_TOKEN_ENDPOINT: ${GOOGLE_TOKEN_ENDPOINT}
      GOOGLE_USERINFO_ENDPOINT: ${GOOGLE_USERINFO_ENDPOINT}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_STORAGE_BUCKET_NAME: ${AWS_STORAGE_BUCKET_NAME}
      AWS_REGION: ${AWS_REGION}
      GROQ_API_KEY: ${GROQ_API_KEY}
      DG_API_KEY: ${DG_API_KEY}
      DOMAIN: ${DOMAIN}
      HUDDDLE_LINK: ${HUDDDLE_LINK}
      MONGODB_URL: ${MONGODB_URL}
      MONGODB_NAME: ${MONGODB_NAME}
    depends_on:
      - redis
  arq_worker:
    container_name: arq_worker
    build: .
    working_dir: /app
    command: arq app_src.arq_worker.WorkerSettings
    environment:
      PYTHONPATH: /app
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET_KEY: ${JWT_SECRET_KEY}
      JWT_ALGORITHM: ${JWT_ALGORITHM}
      MAIL_USERNAME: ${MAIL_USERNAME}
      MAIL_PASSWORD: ${MAIL_PASSWORD}
      MAIL_FROM: ${MAIL_FROM}
      MAIL_PORT: ${MAIL_PORT}
      MAIL_SERVER: ${MAIL_SERVER}
      MAIL_FROM_NAME: ${MAIL_FROM_NAME}
      MAIL_STARTTLS: True
      MAIL_SSL_TLS: False
      USE_CREDENTIALS: True
      VALIDATE_CERTS: True
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GOOGLE_REDIRECT_URI: ${GOOGLE_REDIRECT_URI}
      GOOGLE_AUTH_ENDPOINT: ${GOOGLE_AUTH_ENDPOINT}
      GOOGLE_TOKEN_ENDPOINT: ${GOOGLE_TOKEN_ENDPOINT}
      GOOGLE_USERINFO_ENDPOINT: ${GOOGLE_USERINFO_ENDPOINT}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_STORAGE_BUCKET_NAME: ${AWS_STORAGE_BUCKET_NAME}
      AWS_REGION: ${AWS_REGION}
      GROQ_API_KEY: ${GROQ_API_KEY}
      DG_API_KEY: ${DG_API_KEY}
      DOMAIN: ${DOMAIN}
      HUDDDLE_LINK: ${HUDDDLE_LINK}
      MONGODB_URL: ${MONGODB_URL}
      MONGODB_NAME: ${MONGODB_NAME}
    depends_on:
      - redis
      - api
